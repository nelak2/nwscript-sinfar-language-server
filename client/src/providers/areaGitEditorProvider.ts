/* eslint-disable @typescript-eslint/restrict-template-expressions */
import * as vscode from "vscode";
import { getNonce } from "./utils";

export class AreaGitEditorProvider implements vscode.CustomTextEditorProvider {
  public static register(context: vscode.ExtensionContext): vscode.Disposable {
    const provider = new AreaGitEditorProvider(context);
    const providerRegistration = vscode.window.registerCustomEditorProvider(AreaGitEditorProvider.viewType, provider);
    return providerRegistration;
  }

  private static readonly viewType = "sinfar.areaGitEditor";
  private readonly _context: vscode.ExtensionContext;
  private static readonly scratchCharacters = ["üò∏", "üòπ", "üò∫", "üòª", "üòº", "üòΩ", "üòæ", "üôÄ", "üòø", "üê±"];

  constructor(private readonly context: vscode.ExtensionContext) {
    this._context = context;
  }

  /**
   * Called when our custom editor is opened.
   *
   *
   */
  public async resolveCustomTextEditor(
    document: vscode.TextDocument,
    webviewPanel: vscode.WebviewPanel,
    _token: vscode.CancellationToken,
  ): Promise<void> {
    // Setup initial content for the webview
    webviewPanel.webview.options = {
      enableScripts: true,
    };
    webviewPanel.webview.html = this.getHtmlForWebview(webviewPanel.webview);

    async function updateWebview() {
      void webviewPanel.webview.postMessage({
        type: "update",
        text: document.getText(),
      });
    }

    // Hook up event handlers so that we can synchronize the webview with the text document.
    //
    // The text document acts as our model, so we have to sync change in the document to our
    // editor and sync changes in the editor back to the document.
    //
    // Remember that a single text document can also be shared between multiple custom
    // editors (this happens for example when you split a custom editor)

    const changeDocumentSubscription = vscode.workspace.onDidChangeTextDocument(async (e) => {
      if (e.document.uri.toString() === document.uri.toString()) {
        void updateWebview();
      }
    });

    // Make sure we get rid of the listener when our editor is closed.
    webviewPanel.onDidDispose(() => {
      changeDocumentSubscription.dispose();
    });

    // Receive message from the webview.
    webviewPanel.webview.onDidReceiveMessage(async (e) => {
      switch (e.type) {
        case "add":
          void this.addNewScratch(document);
          return;

        case "delete":
          void this.deleteScratch(document, e.id);
      }
    });

    void updateWebview();
  }

  /**
   * Get the static html used for the editor webviews.
   */
  private getHtmlForWebview(webview: vscode.Webview): string {
    // Local path to script and css for the webview
    const scriptUri = webview.asWebviewUri(vscode.Uri.joinPath(this.context.extensionUri, "client", "media", "catScratch.js"));

    const styleResetUri = webview.asWebviewUri(vscode.Uri.joinPath(this.context.extensionUri, "client", "media", "reset.css"));

    const styleVSCodeUri = webview.asWebviewUri(vscode.Uri.joinPath(this.context.extensionUri, "client", "media", "vscode.css"));

    const styleMainUri = webview.asWebviewUri(
      vscode.Uri.joinPath(this.context.extensionUri, "client", "media", "catScratch.css"),
    );

    // Use a nonce to whitelist which scripts can be run
    const nonce = getNonce();

    return /* html */ `
			<!DOCTYPE html>
			<html lang="en">
			<head>
				<meta charset="UTF-8">
				<!--
				Use a content security policy to only allow loading images from https or from our extension directory,
				and only allow scripts that have a specific nonce.
				-->
				<meta name="viewport" content="width=device-width, initial-scale=1.0">
			</head>
			<body>
				<div id="page_body_wrapper">
<div id="main_table_container">
	<h3 id="page_title">atsm_up_halls.git</h3>
	<table id="main_table" class="game_structure">
	<thead class="expandable_res_fields_section_header "><tr><th colspan="2" class="align_center" class="separator">Audio</th></tr></thead><tbody class="hidden expandable_res_fields_section_body"><tr class="hr_label_value"><th>Day - Ambient Sound:</th><td><select id="res_input_AmbientSndDay" class="res_choices"><option value="0">(No Ambient Sound)()</option><option value="1">Men Whisper Inside(al_pl_whispersm)</option><option value="2">Women Whisper Inside(al_pl_whispersf)</option><option value="3">People Whisper Inside(al_pl_whispers)</option><option value="4">Small Group Talks Inside(al_pl_talkingsml)</option><option value="5">Medium Group Talks Inside(al_pl_talkingmed)</option><option value="6">Large Group Talks Inside(al_pl_talkinglrg)</option><option value="7">Commoner Tavern Talk(al_pl_tavhubbub1)</option><option value="8">Noble Tavern Talk(al_pl_tavhubbub2)</option><option value="9">City Slums Day Crowded(al_pl_slumday1)</option><option value="10">City Slums Day Sparse(al_pl_slumday2)</option><option value="11">City Slums Night(al_pl_slumnite)</option><option value="12">City Day Crowded(al_pl_cityday1)</option><option value="13">City Day Sparse(al_pl_cityday2)</option><option value="14">City Night(al_pl_citynite)</option><option value="15">City Market(al_pl_marketday)</option><option value="16">City Temple District(al_pl_templesday)</option><option value="17">Town Day Crowded(al_pl_townday1)</option><option value="18">Town Day Sparse(al_pl_townday2)</option><option value="19">Town Night(al_pl_townnite)</option><option value="20">Bordello Women(al_pl_bordello1)</option><option value="21">Bordello Men and Women(al_pl_bordello2)</option><option value="22">Riot Outside(al_pl_riot1)</option><option value="23">Riot Muffled(al_pl_riot2)</option><option value="24">Combat Outside 1(al_pl_combat1)</option><option value="25">Combat Outside 2(al_pl_combat2)</option><option value="26">Combat Muffled 1(al_pl_combatmuf1)</option><option value="27">Combat Muffled 2(al_pl_combatmuf2)</option><option value="28">Dungeon Lava Lake(al_na_lavalake1)</option><option value="29">Sewer Sludge Lake(al_na_sludglake1)</option><option value="30">Wind Soft(al_wt_windsoft1)</option><option value="31">Wind Medium(al_wt_windmed1)</option><option value="32">Wind Strong(al_wt_windstrng1)</option><option value="33">Wind Forest(al_wt_windforst1)</option><option value="34">Wind Chasm(al_wt_gustchasm1)</option><option value="35">Wind Cavern(al_wt_gustcavrn1)</option><option value="36">Wind Grass(al_wt_gustgrass1)</option><option value="37">Wind Draft(al_wt_gustdraft1)</option><option value="38">Rain Light(al_wt_rainlight1)</option><option value="39">Rain Hard(al_wt_rainhard1)</option><option value="40">Rainstorm Small(al_wt_stormsm1)</option><option value="41">Rainstorm Big(al_wt_stormlg1)</option><option value="42">Cave Insects 1(al_an_bugscave1)</option><option value="43">Cave Insects 2(al_an_bugscave2)</option><option value="44">Interior Insects 1(al_an_bughouse1)</option><option value="45">Interior Insects 2(al_an_bughouse2)</option><option value="46">Lizardfolk Cave Crystals(al_an_lizrdflk1)</option><option value="47">Sewers 1(al_cv_seweramb1)</option><option value="48">Sewers 2(al_cv_seweramb2)</option><option value="49">Forest Day 1(al_na_frstdyamb1)</option><option value="50">Forest Day 2(al_na_frstdyamb2)</option><option value="51">Forest Day 3(al_na_frstdyamb3)</option><option value="52">Forest Day Scary(al_na_frstdyscr1)</option><option value="53">Forest Night 1(al_na_frstntamb1)</option><option value="54">Forest Night 2(al_na_frstntamb2)</option><option value="55">Forest Night Scary(al_na_frstntscr1)</option><option value="56">Forest Magical(al_na_frstmagic1)</option><option value="57">Evil Dungeon Small(al_cv_evldunamb1)</option><option value="58">Evil Dungeon Medium(al_cv_evldunamb2)</option><option value="59">Evil Dungeon Large(al_cv_evldunamb3)</option><option value="60">Cave Small(al_cv_caveamb1)</option><option value="61">Cave Medium(al_cv_caveamb2)</option><option value="62">Cave Large(al_cv_caveamb3)</option><option value="63">Mine Small(al_cv_mineamb1)</option><option value="64">Mine Medium(al_cv_mineamb2)</option><option value="65">Mine Large(al_cv_mineamb3)</option><option value="66">Castle Interior Small(al_cv_castleamb1)</option><option value="67">Castle Interior Medium(al_cv_castleamb2)</option><option value="68">Castle Interior Large(al_cv_castleamb3)</option><option value="69">Crypt Small(al_cv_cryptamb1)</option><option value="70">Crypt Medium 1(al_cv_cryptamb2)</option><option value="71">Crypt Medium 2(al_cv_cryptamb3)</option><option value="72">House Interior 1(al_cv_houseamb1)</option><option value="73">House Interior 2(al_cv_houseamb2)</option><option value="74">House Interior 3(al_cv_houseamb3)</option><option value="75">Kitchen Interior Small(al_cv_kitchamb1)</option><option value="76">Kitchen Interior Large(al_cv_kitchamb2)</option><option value="77">Haunted Interior 1(al_cv_hauntamb1)</option><option value="78">Haunted Interior 2(al_cv_hauntamb2)</option><option value="79">Haunted Interior 3(al_cv_hauntamb3)</option><option value="80">Blacksmith Shop(al_pl_blacksmith)</option><option value="81">Pit Cries(al_mg_pitcry1)</option><option value="82">Magical Interior Small(al_mg_magicint1)</option><option value="83">Magical Interior Medium(al_mg_magicint2)</option><option value="84">Magical Interior Large(al_mg_magicint3)</option><option value="85">Magical Interior Evil(al_mg_magicint4)</option><option value="86">Magical Interior Firelab(al_mg_firelab1)</option><option value="87">Magical Interior Earthlab(al_mg_earthlab1)</option><option value="88">Magical Interior Airlab(al_mg_airlab1)</option><option value="89">Magical Interior Waterlab(al_mg_waterlab1)</option><option value="90">Winter Day Wet(al_na_x0snw1)</option><option value="91">Winter Day Windy(al_na_x0snw2)</option><option value="92">Desert Day(al_na_x0des1)</option><option value="93">Desert Night(al_na_x0des2)</option><option value="94">Monastery Interior(al_mg_x0ssan)</option><option value="96">Ruins, Wet(al_mg_x0rui1)</option><option value="97">Ruins, Rumbling(al_mg_x0rui2)</option><option value="98">Ruins, Haunted(al_mg_x0rui3)</option><option value="99">Sandstorm, Light(al_na_x0sstm1)</option><option value="100">Sandstorm, Extreme(al_na_x0sstm2)</option><option value="101">Evil Drone(al_mg_x2evdrone)</option><option value="102">Plane of Fire(al_mg_x2fireplan)</option><option value="103">Frozen Hell(al_mg_x2frznhell)</option><option value="104">Cave Evil 1(al_na_x2evcavlrg)</option><option value="105">Cave Evil 2(al_na_x2evcavmed)</option><option value="106">Cave Evil 3(al_na_x2evcavsml)</option><option value="107">Tavern, Rowdy(al_pl_x2tavern)</option><option value="108">Sea Surf Small(al_na_seawaves)</option><option value="109">Sea Surf Large(al_na_seawaves2)</option><option value="110">Crow Caws(al_wt_windcrows)</option><option value="111">Crow Caws(al_wt_windcrows2)</option><option value="112">Owl Hoots(al_wt_windowls)</option><option value="113">Owl HootsNIGHT(al_wt_windowls2)</option></select></td></tr><tr class="hr_label_value"><th>Day - Ambient Volume:</th><td><input type="text" id="res_input_AmbientSndDayVol" value="" class="res_num res_num_char"></td></tr><tr class="hr_label_value"><th>Day - Music:</th><td><select id="res_input_MusicDay" class="res_choices"><option value="0">(No Music Track)()</option><option value="1">Rural Day 1(mus_ruralday1)</option><option value="2">Rural Day 2(mus_ruralday2)</option><option value="3">Rural Night(mus_ruralnite)</option><option value="4">Forest Day 1(mus_forestday1)</option><option value="5">Forest Day 2(mus_forestday2)</option><option value="6">Forest Night(mus_forestnite)</option><option value="7">Generic Dungeon(mus_gendungeon1)</option><option value="8">Sewer (mus_sewer)</option><option value="9">Mines 1(mus_mines1)</option><option value="10">Mines 2(mus_mines2)</option><option value="11">Crypt 1(mus_crypt1)</option><option value="12">Crypt 2(mus_crypt2)</option><option value="13">Evil Dungeon 1(mus_evildungeon1)</option><option value="14">Evil Dungeon 2(mus_evildungeon2)</option><option value="15">City Slum Day(mus_cityslumday)</option><option value="16">City Slum Night(mus_cityslumnite)</option><option value="17">City Docks Day(mus_citydockday)</option><option value="18">City Docks Night(mus_citydocknite)</option><option value="19">City Wealthy(mus_citywealthy)</option><option value="20">City Marketplace (mus_citymarket)</option><option value="21">City Night(mus_citynite)</option><option value="22">Tavern 1(mus_tavern1)</option><option value="23">Tavern 2(mus_tavern2)</option><option value="24">Tavern 3(mus_tavern3)</option><option value="25">Generic Wealthy House(mus_richhouse)</option><option value="26">Generic Store(mus_store)</option><option value="27">Good Temple(mus_templegood)</option><option value="28">Evil Temple(mus_templeevil)</option><option value="29">NWN City Theme(mus_theme_nwn)</option><option value="30">NWN Chapter 1(mus_theme_chap1)</option><option value="31">NWN Chapter 2 (mus_theme_chap2)</option><option value="32">NWN Chapter 3(mus_theme_chap3)</option><option value="33">NWN Chapter 4(mus_theme_chap4)</option><option value="34">Rural Combat 1(mus_bat_rural1)</option><option value="35">Forest Combat 1(mus_bat_forest1)</option><option value="36">Forest Combat 2(mus_bat_forest2)</option><option value="37">Dungeon Combat 1(mus_bat_dung1)</option><option value="38">Dungeon Combat 2(mus_bat_dung2)</option><option value="39">Dungeon Combat 3(mus_bat_dung3)</option><option value="40">City Combat 1(mus_bat_city1)</option><option value="41">City Combat 2(mus_bat_city2)</option><option value="42">City Combat 3(mus_bat_city3)</option><option value="43">Boss Combat City (mus_bat_citboss)</option><option value="44">Boss Combat Forest(mus_bat_forboss)</option><option value="45">Boss Lizardfolk(mus_bat_lizboss)</option><option value="46">Dragon Combat(mus_bat_dragon)</option><option value="47">Combat Aribeth(mus_bat_aribeth)</option><option value="48">Final Boss Combat Source Stone(mus_bat_endboss)</option><option value="49">Good Temple 2(mus_templegood2)</option><option value="50">Generic Castle Interior(mus_castle)</option><option value="51">Aribeth Theme 1(mus_theme_aribgd)</option><option value="52">Aribeth Theme 2(mus_theme_aribev)</option><option value="53">Theme Aarin Gend(mus_theme_argend)</option><option value="54">Theme Maugrim(mus_theme_maugrm)</option><option value="55">Theme Morag(mus_theme_morag)</option><option value="56">Tavern 4(mus_tavern4)</option><option value="57">Desert Combat(mus_bat_x0desert)</option><option value="58">Desert Day(mus_x0desertday)</option><option value="59">Winter Day(mus_x0winterday)</option><option value="60">Fight! Fight!(mus_bat_x0winter)</option><option value="61">Desert Night(mus_x0desertngt)</option><option value="62">XP2 - Theme(mus_x2theme)</option><option value="63">XP2 - Waterdeep(mus_x2waterdeep)</option><option value="64">XP2 - Undermountain(mus_x2undermtn)</option><option value="65">XP2 - Rebel Camp(mus_x2rebelcamp)</option><option value="66">XP2 - Beholder Caves(mus_x2fireplane)</option><option value="67">XP2 - Queen of the Shattered Mirror(mus_x2queen)</option><option value="68">XP2 - Chapter 3(mus_x2frozenhell)</option><option value="69">XP2 - Dracolich(mus_x2draco)</option><option value="70">XP2 - Battle, Small(mus_bat_x2small)</option><option value="71">XP2 - Battle, Medium(mus_bat_x2med)</option><option value="72">XP2 - Battle, Large(mus_bat_x2large)</option><option value="73">XP2 - Battle, Chapter 3(mus_bat_x2hell)</option><option value="74">XP2 - Battle, Matron(mus_bat_x2boss1)</option><option value="75">XP2 - Battle, Final(mus_bat_x2boss2)</option><option value="76">PM - Kingmaker Theme(mus_dd_kingmaker)</option><option value="77">PM - ShadowGuard Theme(mus_dd_shadowgua)</option><option value="78">PM - Witch's Wake Theme(mus_dd_witchwake)</option><option value="79">PM - Pirates Theme(mus_dd_islands)</option><option value="80">PM - Pirates Theme Variation(mus_dd_pirates)</option><option value="81">PM - Infinite Dungeons(mus_dd_infdun)</option><option value="82">PM - Wyvern Crown Ogma(mus_wc_ogma)</option><option value="83">PM - Wyvern Crown Open Road(mus_wc_openroad)</option><option value="84">PM - Wyvern Crown Smoke and Ash(mus_wc_smokeash)</option><option value="85">PM - Wyvern Crown Rural(mus_wc_rural)</option><option value="86">PM - Wyvern Crown Rural Guitar(mus_wc_ruralg)</option><option value="87">PM - Wyvern Crown Tears(mus_wc_tears)</option><option value="88">PM - Wyvern Crown Battle Chase(mus_bat_wcchase)</option><option value="89">PM - Wyvern Crown Theme(mus_wc_theme)</option><option value="90">PM - Wyvern Crown Armchair(mus_wc_armchair)</option><option value="91">PM - Wyvern Crown Battle(mus_bat_wcbattle)</option><option value="92">PM - Wyvern Crown Solace(mus_wc_solace)</option><option value="93">PM - Wyvern Crown Knighted(mus_wc_knighted)</option><option value="94">PM - Wyvern Crown Opening(mus_wc_opening)</option><option value="95">PM - Wyvern Crown Morfen(mus_wc_morfen)</option><option value="96">Bad Strref(mus_pmp01_)</option><option value="97">Bad Strref(mus_pmp02_)</option><option value="98">Bad Strref(mus_pmp03_)</option><option value="99">Bad Strref(mus_pmp04_)</option><option value="100">Bad Strref(mus_pmp05_)</option><option value="101">Bad Strref(mus_pmp06_)</option><option value="102">Bad Strref(mus_pmp07_)</option><option value="103">Bad Strref(mus_pmp08_)</option><option value="104">Bad Strref(mus_pmp09_)</option><option value="105">Bad Strref(mus_pmp10_)</option><option value="106">Bad Strref(mus_pmp11_)</option><option value="107">Bad Strref(mus_pmp12_)</option><option value="108">Bad Strref(mus_pmp13_)</option><option value="109">Bad Strref(mus_pmp14_)</option><option value="110">Bad Strref(mus_pmp15_)</option><option value="111">Bad Strref(mus_pmp16_)</option><option value="112">Bad Strref(mus_pmp17_)</option><option value="113">Bad Strref(mus_pmp18_)</option><option value="114">Bad Strref(mus_pmp19_)</option><option value="115">Bad Strref(mus_pmp20_)</option><option value="116">Bad Strref(mus_pmp21_)</option><option value="117">Bad Strref(mus_pmp22_)</option><option value="118">Bad Strref(mus_pmp23_)</option><option value="119">Bad Strref(mus_pmp24_)</option><option value="120">Bad Strref(mus_pmp25_)</option><option value="121">Bad Strref(mus_pmp26_)</option><option value="122">Bad Strref(mus_pmp27_)</option><option value="123">Bad Strref(mus_pmp28_)</option><option value="124">Bad Strref(mus_pmp29_)</option><option value="125">Bad Strref(mus_pmp30_)</option><option value="126">Bad Strref(mus_pmp31_)</option><option value="127">Bad Strref(mus_pmp32_)</option><option value="128">Bad Strref(mus_pmp33_)</option><option value="129">Bad Strref(mus_pmp34_)</option><option value="130">Bad Strref(mus_pmp35_)</option><option value="131">Bad Strref(mus_pmp36_)</option><option value="132">Bad Strref(mus_pmp37_)</option><option value="133">Bad Strref(mus_pmp38_)</option></select></td></tr><tr class="hr_label_value"><th>Night - Ambient Sound:</th><td><select id="res_input_AmbientSndNight" class="res_choices"><option value="0">(No Ambient Sound)()</option><option value="1">Men Whisper Inside(al_pl_whispersm)</option><option value="2">Women Whisper Inside(al_pl_whispersf)</option><option value="3">People Whisper Inside(al_pl_whispers)</option><option value="4">Small Group Talks Inside(al_pl_talkingsml)</option><option value="5">Medium Group Talks Inside(al_pl_talkingmed)</option><option value="6">Large Group Talks Inside(al_pl_talkinglrg)</option><option value="7">Commoner Tavern Talk(al_pl_tavhubbub1)</option><option value="8">Noble Tavern Talk(al_pl_tavhubbub2)</option><option value="9">City Slums Day Crowded(al_pl_slumday1)</option><option value="10">City Slums Day Sparse(al_pl_slumday2)</option><option value="11">City Slums Night(al_pl_slumnite)</option><option value="12">City Day Crowded(al_pl_cityday1)</option><option value="13">City Day Sparse(al_pl_cityday2)</option><option value="14">City Night(al_pl_citynite)</option><option value="15">City Market(al_pl_marketday)</option><option value="16">City Temple District(al_pl_templesday)</option><option value="17">Town Day Crowded(al_pl_townday1)</option><option value="18">Town Day Sparse(al_pl_townday2)</option><option value="19">Town Night(al_pl_townnite)</option><option value="20">Bordello Women(al_pl_bordello1)</option><option value="21">Bordello Men and Women(al_pl_bordello2)</option><option value="22">Riot Outside(al_pl_riot1)</option><option value="23">Riot Muffled(al_pl_riot2)</option><option value="24">Combat Outside 1(al_pl_combat1)</option><option value="25">Combat Outside 2(al_pl_combat2)</option><option value="26">Combat Muffled 1(al_pl_combatmuf1)</option><option value="27">Combat Muffled 2(al_pl_combatmuf2)</option><option value="28">Dungeon Lava Lake(al_na_lavalake1)</option><option value="29">Sewer Sludge Lake(al_na_sludglake1)</option><option value="30">Wind Soft(al_wt_windsoft1)</option><option value="31">Wind Medium(al_wt_windmed1)</option><option value="32">Wind Strong(al_wt_windstrng1)</option><option value="33">Wind Forest(al_wt_windforst1)</option><option value="34">Wind Chasm(al_wt_gustchasm1)</option><option value="35">Wind Cavern(al_wt_gustcavrn1)</option><option value="36">Wind Grass(al_wt_gustgrass1)</option><option value="37">Wind Draft(al_wt_gustdraft1)</option><option value="38">Rain Light(al_wt_rainlight1)</option><option value="39">Rain Hard(al_wt_rainhard1)</option><option value="40">Rainstorm Small(al_wt_stormsm1)</option><option value="41">Rainstorm Big(al_wt_stormlg1)</option><option value="42">Cave Insects 1(al_an_bugscave1)</option><option value="43">Cave Insects 2(al_an_bugscave2)</option><option value="44">Interior Insects 1(al_an_bughouse1)</option><option value="45">Interior Insects 2(al_an_bughouse2)</option><option value="46">Lizardfolk Cave Crystals(al_an_lizrdflk1)</option><option value="47">Sewers 1(al_cv_seweramb1)</option><option value="48">Sewers 2(al_cv_seweramb2)</option><option value="49">Forest Day 1(al_na_frstdyamb1)</option><option value="50">Forest Day 2(al_na_frstdyamb2)</option><option value="51">Forest Day 3(al_na_frstdyamb3)</option><option value="52">Forest Day Scary(al_na_frstdyscr1)</option><option value="53">Forest Night 1(al_na_frstntamb1)</option><option value="54">Forest Night 2(al_na_frstntamb2)</option><option value="55">Forest Night Scary(al_na_frstntscr1)</option><option value="56">Forest Magical(al_na_frstmagic1)</option><option value="57">Evil Dungeon Small(al_cv_evldunamb1)</option><option value="58">Evil Dungeon Medium(al_cv_evldunamb2)</option><option value="59">Evil Dungeon Large(al_cv_evldunamb3)</option><option value="60">Cave Small(al_cv_caveamb1)</option><option value="61">Cave Medium(al_cv_caveamb2)</option><option value="62">Cave Large(al_cv_caveamb3)</option><option value="63">Mine Small(al_cv_mineamb1)</option><option value="64">Mine Medium(al_cv_mineamb2)</option><option value="65">Mine Large(al_cv_mineamb3)</option><option value="66">Castle Interior Small(al_cv_castleamb1)</option><option value="67">Castle Interior Medium(al_cv_castleamb2)</option><option value="68">Castle Interior Large(al_cv_castleamb3)</option><option value="69">Crypt Small(al_cv_cryptamb1)</option><option value="70">Crypt Medium 1(al_cv_cryptamb2)</option><option value="71">Crypt Medium 2(al_cv_cryptamb3)</option><option value="72">House Interior 1(al_cv_houseamb1)</option><option value="73">House Interior 2(al_cv_houseamb2)</option><option value="74">House Interior 3(al_cv_houseamb3)</option><option value="75">Kitchen Interior Small(al_cv_kitchamb1)</option><option value="76">Kitchen Interior Large(al_cv_kitchamb2)</option><option value="77">Haunted Interior 1(al_cv_hauntamb1)</option><option value="78">Haunted Interior 2(al_cv_hauntamb2)</option><option value="79">Haunted Interior 3(al_cv_hauntamb3)</option><option value="80">Blacksmith Shop(al_pl_blacksmith)</option><option value="81">Pit Cries(al_mg_pitcry1)</option><option value="82">Magical Interior Small(al_mg_magicint1)</option><option value="83">Magical Interior Medium(al_mg_magicint2)</option><option value="84">Magical Interior Large(al_mg_magicint3)</option><option value="85">Magical Interior Evil(al_mg_magicint4)</option><option value="86">Magical Interior Firelab(al_mg_firelab1)</option><option value="87">Magical Interior Earthlab(al_mg_earthlab1)</option><option value="88">Magical Interior Airlab(al_mg_airlab1)</option><option value="89">Magical Interior Waterlab(al_mg_waterlab1)</option><option value="90">Winter Day Wet(al_na_x0snw1)</option><option value="91">Winter Day Windy(al_na_x0snw2)</option><option value="92">Desert Day(al_na_x0des1)</option><option value="93">Desert Night(al_na_x0des2)</option><option value="94">Monastery Interior(al_mg_x0ssan)</option><option value="96">Ruins, Wet(al_mg_x0rui1)</option><option value="97">Ruins, Rumbling(al_mg_x0rui2)</option><option value="98">Ruins, Haunted(al_mg_x0rui3)</option><option value="99">Sandstorm, Light(al_na_x0sstm1)</option><option value="100">Sandstorm, Extreme(al_na_x0sstm2)</option><option value="101">Evil Drone(al_mg_x2evdrone)</option><option value="102">Plane of Fire(al_mg_x2fireplan)</option><option value="103">Frozen Hell(al_mg_x2frznhell)</option><option value="104">Cave Evil 1(al_na_x2evcavlrg)</option><option value="105">Cave Evil 2(al_na_x2evcavmed)</option><option value="106">Cave Evil 3(al_na_x2evcavsml)</option><option value="107">Tavern, Rowdy(al_pl_x2tavern)</option><option value="108">Sea Surf Small(al_na_seawaves)</option><option value="109">Sea Surf Large(al_na_seawaves2)</option><option value="110">Crow Caws(al_wt_windcrows)</option><option value="111">Crow Caws(al_wt_windcrows2)</option><option value="112">Owl Hoots(al_wt_windowls)</option><option value="113">Owl HootsNIGHT(al_wt_windowls2)</option></select></td></tr><tr class="hr_label_value"><th>Night - Ambient Volume:</th><td><input type="text" id="res_input_AmbientSndNitVol" value="" class="res_num res_num_char"></td></tr><tr class="hr_label_value"><th>Night - Music:</th><td><select id="res_input_MusicNight" class="res_choices"><option value="0">(No Music Track)()</option><option value="1">Rural Day 1(mus_ruralday1)</option><option value="2">Rural Day 2(mus_ruralday2)</option><option value="3">Rural Night(mus_ruralnite)</option><option value="4">Forest Day 1(mus_forestday1)</option><option value="5">Forest Day 2(mus_forestday2)</option><option value="6">Forest Night(mus_forestnite)</option><option value="7">Generic Dungeon(mus_gendungeon1)</option><option value="8">Sewer (mus_sewer)</option><option value="9">Mines 1(mus_mines1)</option><option value="10">Mines 2(mus_mines2)</option><option value="11">Crypt 1(mus_crypt1)</option><option value="12">Crypt 2(mus_crypt2)</option><option value="13">Evil Dungeon 1(mus_evildungeon1)</option><option value="14">Evil Dungeon 2(mus_evildungeon2)</option><option value="15">City Slum Day(mus_cityslumday)</option><option value="16">City Slum Night(mus_cityslumnite)</option><option value="17">City Docks Day(mus_citydockday)</option><option value="18">City Docks Night(mus_citydocknite)</option><option value="19">City Wealthy(mus_citywealthy)</option><option value="20">City Marketplace (mus_citymarket)</option><option value="21">City Night(mus_citynite)</option><option value="22">Tavern 1(mus_tavern1)</option><option value="23">Tavern 2(mus_tavern2)</option><option value="24">Tavern 3(mus_tavern3)</option><option value="25">Generic Wealthy House(mus_richhouse)</option><option value="26">Generic Store(mus_store)</option><option value="27">Good Temple(mus_templegood)</option><option value="28">Evil Temple(mus_templeevil)</option><option value="29">NWN City Theme(mus_theme_nwn)</option><option value="30">NWN Chapter 1(mus_theme_chap1)</option><option value="31">NWN Chapter 2 (mus_theme_chap2)</option><option value="32">NWN Chapter 3(mus_theme_chap3)</option><option value="33">NWN Chapter 4(mus_theme_chap4)</option><option value="34">Rural Combat 1(mus_bat_rural1)</option><option value="35">Forest Combat 1(mus_bat_forest1)</option><option value="36">Forest Combat 2(mus_bat_forest2)</option><option value="37">Dungeon Combat 1(mus_bat_dung1)</option><option value="38">Dungeon Combat 2(mus_bat_dung2)</option><option value="39">Dungeon Combat 3(mus_bat_dung3)</option><option value="40">City Combat 1(mus_bat_city1)</option><option value="41">City Combat 2(mus_bat_city2)</option><option value="42">City Combat 3(mus_bat_city3)</option><option value="43">Boss Combat City (mus_bat_citboss)</option><option value="44">Boss Combat Forest(mus_bat_forboss)</option><option value="45">Boss Lizardfolk(mus_bat_lizboss)</option><option value="46">Dragon Combat(mus_bat_dragon)</option><option value="47">Combat Aribeth(mus_bat_aribeth)</option><option value="48">Final Boss Combat Source Stone(mus_bat_endboss)</option><option value="49">Good Temple 2(mus_templegood2)</option><option value="50">Generic Castle Interior(mus_castle)</option><option value="51">Aribeth Theme 1(mus_theme_aribgd)</option><option value="52">Aribeth Theme 2(mus_theme_aribev)</option><option value="53">Theme Aarin Gend(mus_theme_argend)</option><option value="54">Theme Maugrim(mus_theme_maugrm)</option><option value="55">Theme Morag(mus_theme_morag)</option><option value="56">Tavern 4(mus_tavern4)</option><option value="57">Desert Combat(mus_bat_x0desert)</option><option value="58">Desert Day(mus_x0desertday)</option><option value="59">Winter Day(mus_x0winterday)</option><option value="60">Fight! Fight!(mus_bat_x0winter)</option><option value="61">Desert Night(mus_x0desertngt)</option><option value="62">XP2 - Theme(mus_x2theme)</option><option value="63">XP2 - Waterdeep(mus_x2waterdeep)</option><option value="64">XP2 - Undermountain(mus_x2undermtn)</option><option value="65">XP2 - Rebel Camp(mus_x2rebelcamp)</option><option value="66">XP2 - Beholder Caves(mus_x2fireplane)</option><option value="67">XP2 - Queen of the Shattered Mirror(mus_x2queen)</option><option value="68">XP2 - Chapter 3(mus_x2frozenhell)</option><option value="69">XP2 - Dracolich(mus_x2draco)</option><option value="70">XP2 - Battle, Small(mus_bat_x2small)</option><option value="71">XP2 - Battle, Medium(mus_bat_x2med)</option><option value="72">XP2 - Battle, Large(mus_bat_x2large)</option><option value="73">XP2 - Battle, Chapter 3(mus_bat_x2hell)</option><option value="74">XP2 - Battle, Matron(mus_bat_x2boss1)</option><option value="75">XP2 - Battle, Final(mus_bat_x2boss2)</option><option value="76">PM - Kingmaker Theme(mus_dd_kingmaker)</option><option value="77">PM - ShadowGuard Theme(mus_dd_shadowgua)</option><option value="78">PM - Witch's Wake Theme(mus_dd_witchwake)</option><option value="79">PM - Pirates Theme(mus_dd_islands)</option><option value="80">PM - Pirates Theme Variation(mus_dd_pirates)</option><option value="81">PM - Infinite Dungeons(mus_dd_infdun)</option><option value="82">PM - Wyvern Crown Ogma(mus_wc_ogma)</option><option value="83">PM - Wyvern Crown Open Road(mus_wc_openroad)</option><option value="84">PM - Wyvern Crown Smoke and Ash(mus_wc_smokeash)</option><option value="85">PM - Wyvern Crown Rural(mus_wc_rural)</option><option value="86">PM - Wyvern Crown Rural Guitar(mus_wc_ruralg)</option><option value="87">PM - Wyvern Crown Tears(mus_wc_tears)</option><option value="88">PM - Wyvern Crown Battle Chase(mus_bat_wcchase)</option><option value="89">PM - Wyvern Crown Theme(mus_wc_theme)</option><option value="90">PM - Wyvern Crown Armchair(mus_wc_armchair)</option><option value="91">PM - Wyvern Crown Battle(mus_bat_wcbattle)</option><option value="92">PM - Wyvern Crown Solace(mus_wc_solace)</option><option value="93">PM - Wyvern Crown Knighted(mus_wc_knighted)</option><option value="94">PM - Wyvern Crown Opening(mus_wc_opening)</option><option value="95">PM - Wyvern Crown Morfen(mus_wc_morfen)</option><option value="96">Bad Strref(mus_pmp01_)</option><option value="97">Bad Strref(mus_pmp02_)</option><option value="98">Bad Strref(mus_pmp03_)</option><option value="99">Bad Strref(mus_pmp04_)</option><option value="100">Bad Strref(mus_pmp05_)</option><option value="101">Bad Strref(mus_pmp06_)</option><option value="102">Bad Strref(mus_pmp07_)</option><option value="103">Bad Strref(mus_pmp08_)</option><option value="104">Bad Strref(mus_pmp09_)</option><option value="105">Bad Strref(mus_pmp10_)</option><option value="106">Bad Strref(mus_pmp11_)</option><option value="107">Bad Strref(mus_pmp12_)</option><option value="108">Bad Strref(mus_pmp13_)</option><option value="109">Bad Strref(mus_pmp14_)</option><option value="110">Bad Strref(mus_pmp15_)</option><option value="111">Bad Strref(mus_pmp16_)</option><option value="112">Bad Strref(mus_pmp17_)</option><option value="113">Bad Strref(mus_pmp18_)</option><option value="114">Bad Strref(mus_pmp19_)</option><option value="115">Bad Strref(mus_pmp20_)</option><option value="116">Bad Strref(mus_pmp21_)</option><option value="117">Bad Strref(mus_pmp22_)</option><option value="118">Bad Strref(mus_pmp23_)</option><option value="119">Bad Strref(mus_pmp24_)</option><option value="120">Bad Strref(mus_pmp25_)</option><option value="121">Bad Strref(mus_pmp26_)</option><option value="122">Bad Strref(mus_pmp27_)</option><option value="123">Bad Strref(mus_pmp28_)</option><option value="124">Bad Strref(mus_pmp29_)</option><option value="125">Bad Strref(mus_pmp30_)</option><option value="126">Bad Strref(mus_pmp31_)</option><option value="127">Bad Strref(mus_pmp32_)</option><option value="128">Bad Strref(mus_pmp33_)</option><option value="129">Bad Strref(mus_pmp34_)</option><option value="130">Bad Strref(mus_pmp35_)</option><option value="131">Bad Strref(mus_pmp36_)</option><option value="132">Bad Strref(mus_pmp37_)</option><option value="133">Bad Strref(mus_pmp38_)</option></select></td></tr><tr class="hr_label_value"><th>Battle - Music:</th><td><select id="res_input_MusicBattle" class="res_choices"><option value="0">(No Music Track)()</option><option value="1">Rural Day 1(mus_ruralday1)</option><option value="2">Rural Day 2(mus_ruralday2)</option><option value="3">Rural Night(mus_ruralnite)</option><option value="4">Forest Day 1(mus_forestday1)</option><option value="5">Forest Day 2(mus_forestday2)</option><option value="6">Forest Night(mus_forestnite)</option><option value="7">Generic Dungeon(mus_gendungeon1)</option><option value="8">Sewer (mus_sewer)</option><option value="9">Mines 1(mus_mines1)</option><option value="10">Mines 2(mus_mines2)</option><option value="11">Crypt 1(mus_crypt1)</option><option value="12">Crypt 2(mus_crypt2)</option><option value="13">Evil Dungeon 1(mus_evildungeon1)</option><option value="14">Evil Dungeon 2(mus_evildungeon2)</option><option value="15">City Slum Day(mus_cityslumday)</option><option value="16">City Slum Night(mus_cityslumnite)</option><option value="17">City Docks Day(mus_citydockday)</option><option value="18">City Docks Night(mus_citydocknite)</option><option value="19">City Wealthy(mus_citywealthy)</option><option value="20">City Marketplace (mus_citymarket)</option><option value="21">City Night(mus_citynite)</option><option value="22">Tavern 1(mus_tavern1)</option><option value="23">Tavern 2(mus_tavern2)</option><option value="24">Tavern 3(mus_tavern3)</option><option value="25">Generic Wealthy House(mus_richhouse)</option><option value="26">Generic Store(mus_store)</option><option value="27">Good Temple(mus_templegood)</option><option value="28">Evil Temple(mus_templeevil)</option><option value="29">NWN City Theme(mus_theme_nwn)</option><option value="30">NWN Chapter 1(mus_theme_chap1)</option><option value="31">NWN Chapter 2 (mus_theme_chap2)</option><option value="32">NWN Chapter 3(mus_theme_chap3)</option><option value="33">NWN Chapter 4(mus_theme_chap4)</option><option value="34">Rural Combat 1(mus_bat_rural1)</option><option value="35">Forest Combat 1(mus_bat_forest1)</option><option value="36">Forest Combat 2(mus_bat_forest2)</option><option value="37">Dungeon Combat 1(mus_bat_dung1)</option><option value="38">Dungeon Combat 2(mus_bat_dung2)</option><option value="39">Dungeon Combat 3(mus_bat_dung3)</option><option value="40">City Combat 1(mus_bat_city1)</option><option value="41">City Combat 2(mus_bat_city2)</option><option value="42">City Combat 3(mus_bat_city3)</option><option value="43">Boss Combat City (mus_bat_citboss)</option><option value="44">Boss Combat Forest(mus_bat_forboss)</option><option value="45">Boss Lizardfolk(mus_bat_lizboss)</option><option value="46">Dragon Combat(mus_bat_dragon)</option><option value="47">Combat Aribeth(mus_bat_aribeth)</option><option value="48">Final Boss Combat Source Stone(mus_bat_endboss)</option><option value="49">Good Temple 2(mus_templegood2)</option><option value="50">Generic Castle Interior(mus_castle)</option><option value="51">Aribeth Theme 1(mus_theme_aribgd)</option><option value="52">Aribeth Theme 2(mus_theme_aribev)</option><option value="53">Theme Aarin Gend(mus_theme_argend)</option><option value="54">Theme Maugrim(mus_theme_maugrm)</option><option value="55">Theme Morag(mus_theme_morag)</option><option value="56">Tavern 4(mus_tavern4)</option><option value="57">Desert Combat(mus_bat_x0desert)</option><option value="58">Desert Day(mus_x0desertday)</option><option value="59">Winter Day(mus_x0winterday)</option><option value="60">Fight! Fight!(mus_bat_x0winter)</option><option value="61">Desert Night(mus_x0desertngt)</option><option value="62">XP2 - Theme(mus_x2theme)</option><option value="63">XP2 - Waterdeep(mus_x2waterdeep)</option><option value="64">XP2 - Undermountain(mus_x2undermtn)</option><option value="65">XP2 - Rebel Camp(mus_x2rebelcamp)</option><option value="66">XP2 - Beholder Caves(mus_x2fireplane)</option><option value="67">XP2 - Queen of the Shattered Mirror(mus_x2queen)</option><option value="68">XP2 - Chapter 3(mus_x2frozenhell)</option><option value="69">XP2 - Dracolich(mus_x2draco)</option><option value="70">XP2 - Battle, Small(mus_bat_x2small)</option><option value="71">XP2 - Battle, Medium(mus_bat_x2med)</option><option value="72">XP2 - Battle, Large(mus_bat_x2large)</option><option value="73">XP2 - Battle, Chapter 3(mus_bat_x2hell)</option><option value="74">XP2 - Battle, Matron(mus_bat_x2boss1)</option><option value="75">XP2 - Battle, Final(mus_bat_x2boss2)</option><option value="76">PM - Kingmaker Theme(mus_dd_kingmaker)</option><option value="77">PM - ShadowGuard Theme(mus_dd_shadowgua)</option><option value="78">PM - Witch's Wake Theme(mus_dd_witchwake)</option><option value="79">PM - Pirates Theme(mus_dd_islands)</option><option value="80">PM - Pirates Theme Variation(mus_dd_pirates)</option><option value="81">PM - Infinite Dungeons(mus_dd_infdun)</option><option value="82">PM - Wyvern Crown Ogma(mus_wc_ogma)</option><option value="83">PM - Wyvern Crown Open Road(mus_wc_openroad)</option><option value="84">PM - Wyvern Crown Smoke and Ash(mus_wc_smokeash)</option><option value="85">PM - Wyvern Crown Rural(mus_wc_rural)</option><option value="86">PM - Wyvern Crown Rural Guitar(mus_wc_ruralg)</option><option value="87">PM - Wyvern Crown Tears(mus_wc_tears)</option><option value="88">PM - Wyvern Crown Battle Chase(mus_bat_wcchase)</option><option value="89">PM - Wyvern Crown Theme(mus_wc_theme)</option><option value="90">PM - Wyvern Crown Armchair(mus_wc_armchair)</option><option value="91">PM - Wyvern Crown Battle(mus_bat_wcbattle)</option><option value="92">PM - Wyvern Crown Solace(mus_wc_solace)</option><option value="93">PM - Wyvern Crown Knighted(mus_wc_knighted)</option><option value="94">PM - Wyvern Crown Opening(mus_wc_opening)</option><option value="95">PM - Wyvern Crown Morfen(mus_wc_morfen)</option><option value="96">Bad Strref(mus_pmp01_)</option><option value="97">Bad Strref(mus_pmp02_)</option><option value="98">Bad Strref(mus_pmp03_)</option><option value="99">Bad Strref(mus_pmp04_)</option><option value="100">Bad Strref(mus_pmp05_)</option><option value="101">Bad Strref(mus_pmp06_)</option><option value="102">Bad Strref(mus_pmp07_)</option><option value="103">Bad Strref(mus_pmp08_)</option><option value="104">Bad Strref(mus_pmp09_)</option><option value="105">Bad Strref(mus_pmp10_)</option><option value="106">Bad Strref(mus_pmp11_)</option><option value="107">Bad Strref(mus_pmp12_)</option><option value="108">Bad Strref(mus_pmp13_)</option><option value="109">Bad Strref(mus_pmp14_)</option><option value="110">Bad Strref(mus_pmp15_)</option><option value="111">Bad Strref(mus_pmp16_)</option><option value="112">Bad Strref(mus_pmp17_)</option><option value="113">Bad Strref(mus_pmp18_)</option><option value="114">Bad Strref(mus_pmp19_)</option><option value="115">Bad Strref(mus_pmp20_)</option><option value="116">Bad Strref(mus_pmp21_)</option><option value="117">Bad Strref(mus_pmp22_)</option><option value="118">Bad Strref(mus_pmp23_)</option><option value="119">Bad Strref(mus_pmp24_)</option><option value="120">Bad Strref(mus_pmp25_)</option><option value="121">Bad Strref(mus_pmp26_)</option><option value="122">Bad Strref(mus_pmp27_)</option><option value="123">Bad Strref(mus_pmp28_)</option><option value="124">Bad Strref(mus_pmp29_)</option><option value="125">Bad Strref(mus_pmp30_)</option><option value="126">Bad Strref(mus_pmp31_)</option><option value="127">Bad Strref(mus_pmp32_)</option><option value="128">Bad Strref(mus_pmp33_)</option><option value="129">Bad Strref(mus_pmp34_)</option><option value="130">Bad Strref(mus_pmp35_)</option><option value="131">Bad Strref(mus_pmp36_)</option><option value="132">Bad Strref(mus_pmp37_)</option><option value="133">Bad Strref(mus_pmp38_)</option></select></td></tr><tr class="hr_label_value"><th>Music Playing Delay (milliseconds):</th><td><input type="text" id="res_input_MusicDelay" value="" class="res_num res_num_int"></td></tr><tr class="hr_label_value"><th>Environmental Effects:</th><td><select id="res_input_EnvAudio" class="res_choices"><option value="0">(Generic)</option><option value="1">Padded Cell</option><option value="2">Room</option><option value="3">Bathroom</option><option value="4">Living Room</option><option value="5">Stone Room</option><option value="6">Auditorium</option><option value="7">Concert Hall</option><option value="8">Cave</option><option value="9">Arena</option><option value="10">Hangar</option><option value="11">Carpeted Hallway</option><option value="12">Hallway</option><option value="13">Stone Corridor</option><option value="14">Alley</option><option value="15">Forest</option><option value="16">City</option><option value="17">Mountains</option><option value="18">Quarry</option><option value="19">Plain</option><option value="20">Parking Lot</option><option value="21">Sewer Pipe</option><option value="22">Underwater</option><option value="23">Drugged</option><option value="24">Dizzy</option><option value="25">Psychotic</option><option value="26">Castle, small room</option><option value="27">Castle, short passage</option><option value="28">Castle, medium room</option><option value="29">Castle, long passage</option><option value="30">Castle, large room</option><option value="31">Castle, hall</option><option value="32">Castle, cupboard</option><option value="33">Castle, courtyard</option><option value="34">Castle, alcove</option><option value="35">Factory, alcove</option><option value="36">Factory, short passage</option><option value="37">Factory, medium room</option><option value="38">Factory, long passage</option><option value="39">Factory, large room</option><option value="40">Factory, hall</option><option value="41">Factory, cupboard</option><option value="42">Factory, courtyard</option><option value="43">Factory, small room</option><option value="44">Ice palace, alcove</option><option value="45">Ice palace, short passage</option><option value="46">Ice palace, medium room</option><option value="47">Ice palace, long passage</option><option value="48">Ice palace, large room</option><option value="49">Ice palace, hall</option><option value="50">Ice palace, cupboard</option><option value="51">Ice palace, courtyard</option><option value="52">Ice palace, small room</option><option value="53">Space station, alcove</option><option value="54">Space station, medium room</option><option value="55">Space station, short passage</option><option value="56">Space station, long passage</option><option value="57">Space station, large room</option><option value="58">Space station, hall</option><option value="59">Space station, cupboard</option><option value="60">Space station, small room</option><option value="61">Wooden, alcove</option><option value="62">Wooden, short passage</option><option value="63">Wooden, medium room</option><option value="64">Wooden, long passage</option><option value="65">Wooden, large room</option><option value="66">Wooden, hall</option><option value="67">Wooden, cupboard</option><option value="68">Wooden, small room</option><option value="69">Wooden, courtyard</option><option value="70">Sport, empty stadium</option><option value="71">Sport, squash court</option><option value="72">Sport, small swimming pool</option><option value="73">Sport, large swimming pool</option><option value="74">Sport, gymnasium</option><option value="75">Sport, full stadium</option><option value="76">Sport, stadium tannoy</option><option value="77">Prefab, workshop</option><option value="78">Prefab, school room</option><option value="79">Prefab, practise room</option><option value="80">Prefab, outhouse</option><option value="81">Prefab, caravan</option><option value="82">Dome, tomb</option><option value="83">Dome, saint paul's</option><option value="84">Pipe, small</option><option value="85">Pipe, long and thin</option><option value="86">Pipe, large</option><option value="87">Pipe, resonant</option><option value="88">Outdoors, backyard</option><option value="89">Outdoors, rolling plains</option><option value="90">Outdoors, deep canyon</option><option value="91">Outdoors, creek</option><option value="92">Outdoors, valley</option><option value="93">Mood, heaven</option><option value="94">Mood, hell</option><option value="95">Mood, memory</option><option value="96">Driving, commentator</option><option value="97">Driving, pit garage</option><option value="98">Driving, incar racer</option><option value="99">Driving, incar sports</option><option value="100">Driving, incar luxury</option><option value="101">Driving, full grandstand</option><option value="102">Driving, empty grandstand</option><option value="103">Driving, tunnel</option><option value="104">City, streets</option><option value="105">City, subway</option><option value="106">City, museum</option><option value="107">City, library</option><option value="108">City, underpass</option><option value="109">City, abandoned</option><option value="110">Dusty room</option><option value="111">Chapel</option><option value="112">Small water room</option></select></td></tr></tbody><thead class="expandable_res_fields_section_header variables"><tr><th colspan="2" class="align_center" class="separator">Variables</th></tr></thead><tbody class="hidden expandable_res_fields_section_body"><tr class="hr_label_value"><th>Variables:</th><td><div class="list_table_wrapper"><table id="res_input_list_variables" class="gff_list "></table></div></td></tr><tr class="hr_label_value"><th>Add Variable:</th><td><table><tr class="hr_label_value"><th>Name:</th><td><input type="text" id="res_input_add_variable_name" class="full_width_field"></td></tr><tr class="hr_label_value"><th>Type:</th><td><select id="res_input_add_variable_type" class="res_choices"><option value="3">String</option><option value="1">Integer</option><option value="2">Float</option></select></td></tr><tr class="hr_label_value"><th>Value:</th><td><input type="text" id="res_input_add_variable_value" class="full_width_field"></td></tr><tr><td colspan="2" class="align_center"><input type="button" value="Add/Replace" id="btn_add_variable"></td></tr></table></td></tr>	</tbody>	</table>
</div>
<div id="page_footer_wrapper" class="sinfar_border">
	<div style="margin-left:3px;position:relative;top: 50%;transform: translateY(-50%);">
		<label id="res_git_log">Log:<input type="text"></label>
		<input type="button" value="Save" id="res_save">
		&nbsp;
		<span id="res_save_result"></span>
	</div>
</div>
</div>
			</body>
			</html>`;
  }

  /**
   * Add a new scratch to the current document.
   */
  private addNewScratch(document: vscode.TextDocument) {
    const json = this.getDocumentAsJson(document);
    const character =
      AreaGitEditorProvider.scratchCharacters[Math.floor(Math.random() * AreaGitEditorProvider.scratchCharacters.length)];
    json.scratches = [
      ...(Array.isArray(json.scratches) ? json.scratches : []),
      {
        id: getNonce(),
        text: character,
        created: Date.now(),
      },
    ];

    return this.updateTextDocument(document, json);
  }

  /**
   * Delete an existing scratch from a document.
   */
  private deleteScratch(document: vscode.TextDocument, id: string) {
    const json = this.getDocumentAsJson(document);
    if (!Array.isArray(json.scratches)) {
      return;
    }

    json.scratches = json.scratches.filter((note: any) => note.id !== id);

    return this.updateTextDocument(document, json);
  }

  /**
   * Try to get a current document as json text.
   */
  private getDocumentAsJson(document: vscode.TextDocument): any {
    const text = document.getText();
    if (text.trim().length === 0) {
      return {};
    }

    try {
      return JSON.parse(text);
    } catch {
      throw new Error("Could not get document as json. Content is not valid json");
    }
  }

  /**
   * Write out the json to a given document.
   */
  private updateTextDocument(document: vscode.TextDocument, json: any) {
    const edit = new vscode.WorkspaceEdit();

    // Just replace the entire document every time for this example extension.
    // A more complete extension should compute minimal edits instead.
    edit.replace(document.uri, new vscode.Range(0, 0, document.lineCount, 0), JSON.stringify(json, null, 2));

    return vscode.workspace.applyEdit(edit);
  }
}
